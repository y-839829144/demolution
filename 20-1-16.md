### 工作计划

1. 完善数据库的字段
2. 理清整体的流程逻辑思路
3. 列表页中判断商品是否过期
4. 理清产品页的整个流程





###　云函数的逻辑流程

在砍事件表中添加了siteuser字段(系统用户)

在成功砍价表中添加了event字段(外键绑定)

数据库目前五个表

产品表　product　　　　　列表页

砍事件表 bargainevent　　　产品页

成功砍价表 successbargain　　　详情页

砍表 bargain　　　详情页

订单表　order　　　　表单页

产品表用于记录　商品的名称，图片，详情，价格，目标价格，初始价格，最高砍价，最低砍价，过期日期，开始日期，结束日期

砍事件表外键绑定产品和用户，其实这个表的作用就是将产品和用户关联起来形成一个事件

成功砍价表外键绑定产品　砍事件，记录该事件成功砍价后的，状态，凭证码

砍表　外键关联产品和砍事件，记录该事件用户所砍的价格

订单表　外键关联产品，砍事件，系统订单，　里面还有姓名地址电话备注这些字段，

将用户　产品　系统订单　三者联合起来



表的数据是怎么来的：

产品表:商家在管理页面进行添加

砍事件表：在云函数中没有找到关于该表创建数据的函数,

在产品页通过调用系统接口进行创建

成功砍价表：在云函数　getCode　获取凭证码时创建该表

砍表:　在云函数　doHaggle　去砍价时创建该表

订单表：在云函数　submit_order　提交订单时创建该表

### 遇到的知识点

1. python中round函数

   ```python
   # round()方法返回浮点数x的四舍五入值
   # 语法
   round( x [,n])
   # x --数值表达式
   # n --数值表达式
   print "round(80.23456,2) : ",round(80.23456,2)
   ```

2. 按钮容器

   通过添加按钮容器，然后在容器内部自由定制样式，就可以实现点击容器触发上述功能

3. fields自定义读取部分字段数据，

   可以通过__符号(这里是双下划线)获取外键相关的数据

   ```
   table 1
   name   charfield
   
   table 2 
   name2   charfield
   parent  foreignkey --> table
   --------------------------------
   场景一：查询table2时希望可以获取parent的详细数据
   注意：主表找外表内容　'field__toone'
   DQL:-->
   {
   	query:{
   		datasettable:'table2',
   		fields:[
   		'name2','parent__toone'
   		],
   	}
   }
   RETURN <--
   {
   	meta:{},
   	objects:[
   		{
   			name2:'...',
   			parent__toone:{
   				id:'...',
   				data:{
   					name1:'...'
   				}
   			}
   		}
   	]
   }
   
   场景二：查询table1时希望获取到所有关联的table2列表
   注意：外表找主表内容 
   'tomany__tbname__field'
   tbname:主表名称
   DQL: -->
   {
   	query:{
   		datasettable:'table1',
   		fields:[
   		'name1',
   		'tomany__table2__parent'
   		],
   	}
   }
   
   RETURN <--
   {
   	meta:{},
   	objects:[
   		{
   			name1:'...',
   			tomany__table2__parent:[
   			{
   				id:'...',
   				data:{
   					name2:'...',
   					parent:'...'
   				}
   			}
   			]
   		}
   	]
   }
   ```

4. 数据库的基本概念，关联查询

   ```
   并操作：
   就是把具有相同字段数目和字段类型的表合并到一起，比如存在两张用户表，合并后会发现并操作去掉了重复记录．
   
   内连接：
   自然连接：操作就是表关系的笛卡尔积中，首先根据表关系相同名称的字段自动进行记录匹配，然后去掉重复的字段
   等值连接：
   就是表关系的笛卡尔积中，选择所匹配字段值相等的记录，与自然连接相比保留重复字段
   不等连接：
   就是表关系的笛卡尔积中所匹配字段不相等的数据记录，与等值连接的结果集互补
   
   
   ```

   


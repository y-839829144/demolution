### 详情页

1. 详情页的页面逻辑:

   逻辑呢 主要是商品的展示和加入购物车跟立即购买.稍微附带一些其它小组件功能,比如滚动图,详情,属性,首页和购物车页面的跳转.

   这几个分别怎么实现呢.

   先说商品的展示,如何展示呢.那肯定需要我们的控制器了.当然跟昨天一样,先定义一个state.item对象 ,那么它就是我们所想要找的单个商品了.然后定义它的购买类型,也就是state.buyType,方便在点击确定购买之后,进行页面的跳转,在之后呢 ,那肯定就是购买数量了,所以我们要来定义一个购买数量 state.quantity.

   有了数量那得有商品的颜色呀大小之类的吧,我们接着定义商品的规格

   ,之后我们在来定义一个显示数量的选择框,用来显示或者隐藏选择框

   定义一个state.activeTab用于激活的标签页,具体作用是什么呢,就是为了我们可以查看这个商品的详情,评论,属性.最后一个就是全局配置的定义

   之后的步骤就是 当组件显示时我们要执行加载产品数据的函数和加载全局配置的函数

   这两个函数和之前的定义是一个样子的

   定义一个加载产品数据的函数,里面通过调用 数据集查询数据接口获取到产品的数据,然后就是数据的赋值,将获取到数据的值赋值给我们之前定义的state.item 

   开始我们的页面渲染,页面设计是这样的.

   先来一个条件容器.判断我们是否获取到了商品数据,之后就两个大图加上去,如果有滚动图,我们就可以把小图隐藏起来,如果没有的话就就直接展示小图,接下来添加一个子组合模块,这个模块有什么作用呢,这个模块就是让我们在里面添加关于商品的名称,价格,还有收藏之类的小功能,然后注意给每个小功能绑定好相对应的值.这样我们渲染一下页面就会展示出来我们商品的基本信息.

   之后就是详情和属性,评论之类的了,毕竟咱们的页面是详情页,没有点详情那怎么可以.

   我们再来定义条件容器,用来判断商品是否存在属性,或者详情,并将其渲染出来.

   之后我们就开始定义那几个事件了,点击事件两个,加入购物车事件,立即购买事件.

   这几个事件在控制器中分别定义相对应的函数,然后,在相应的位置上绑定这几个事件.比如在点击首页,我们可以给包裹首页的边框上附加点击事件这样我们点首页这个字段附近我们就可以直接触发我们的函数然后就可以进行页面的跳转

   加入购物车和立即购买,这两个事件会牵扯到一个弹窗和数据的新增问题,那我们得先有云函数 才能进行如下环节,

   我们先来写一个加入购物车和立即购买的云函数,

   我们所需要的参数有些什么,我们需要event,context这两个基本参数,event还得包含有,产品id,产品的规格(sku),产品的uuid,产品的购买类型(一会通过它进行判断是否是立即购买或者加入购物车),购买的数量.我们获取到产品的ID,我们通过ID可以从数据集中查找出所对应的产品来,然后我们调用数据集接口的校验条件false并返回,可以判断我们是否找到了这个商品,如果未找到,可以给一个提示 然后定义一个item用来接收我们所查到的产品对象,然和我们检验一下是否获得产品规格和用户id,接下来就是判断我们是否是加入购物车还是立即购买,通过buyType进行判断.如果是立即购买,则清空购物车,如果是加入购物车,则清空对应的购物车条目

   之后就是我们的计算价格

   带规格产品需要设置为规格价格

   然和就是调用接口创建购物车条目里面的数据,返回一个数据对象

   然和我们所在的页面点击时就会调用这个函数,我们就可以实现数据的添加记录

2. 页面的设计

   两个条件容器一个固定容器

   固定容器有加入购物车

   可以叫做条件容器1,条件容器2,和固定容器1

   条件容器1,用来包含商品的属性,有图片属性,名称属性,价格属性,还有一个标签页切换,固定不动,商品的详情属性,商品的一些分类属性和全局属性.

   全局属性:指商品共有的属性,分类属性指某一类商品独有的属性

3. 犯错:

   在属性绑定上,标签页上有详情,属性,和评论,这三个标签,如何在这三个标签梨进行切换以及数据的传递呢.这时我们用已经开发好的院子组件,并且给这个组件的value属性值,也就是选中的标签页绑定数据

   绑定我们之前定义的activeTab激活的标签页这个数据,注意这里得给它绑上双向绑定,否则他无法判断出标签页的名称是哪个,所以你这时点击属性或者评论他不会给你进行切换,因为无法判断activeTab 等于什么

   下单失败的原因:通过F12检查页面下单时报了没有找到商品的错误 ,然后定位到云函数的筛选动作中,找到动作然后进行原因查找,最后发现是因为返回类型的错误导致下单失败,因为它是产品详情页面所以只需要一个对象即可,不必要返回一个列表,所以这里返回类型得写成第一个条目

   规格,产品属性里面有个规格属性,还有一个是是否开启规格属性,

   如果开启的话,规格属性里面有字段, 在弹窗的时候,才会弹出规格

   条件容器,达到条件的时候,容器内的组件才会显示出来,没有达到条件时,是不会显示出来的,所以我们要修改条件容器里的子组合模块,需要先拉出来修改后,在放回原有的位置